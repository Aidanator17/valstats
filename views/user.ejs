<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <%= UserInfo['username'] %>
    </title>
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
    <div class="container">
        <% if (UserInfo && UserInfo['img'] && UserInfo['username']) { %>
            <div class="profile">
                <img id="playerimg" src="<%= UserInfo['img'] %>" alt="Player Image">
                <h1 id="playername">
                    <%= UserInfo['username'] %>
                        <span id="playertag">
                            <%= UserInfo['tag'] %>
                        </span>
                </h1>
            </div>
            <% } else { %>
                <p>Error: UserInfo data is missing or incomplete.</p>
                <% } %>
                    <div class="stats">
                        <h3>Stats (All Comp Matches)</h3>
                        <div class="statgrid">
                            <div class="statgrid-item">
                                <p class="statgrid-element">
                                    Headshot: <%= UserInfo['stats']['overall']['HSP'] %>%
                                </p>
                                <p class="statgrid-element">
                                    K/D: <%= UserInfo['stats']['overall']['KD'] %>
                                </p>
                                <p class="statgrid-element">
                                    Win: <%= UserInfo['stats']['overall']['wp'] %>%
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="stats">
                        <h3>Stats (Past 5 Comp Matches)</h3>
                        <div class="statgrid">
                            <div class="statgrid-item">
                                <p class="statgrid-element">
                                    Headshot: <%= UserInfo['stats']['past5']['HSP'] %>%
                                </p>
                                <p class="statgrid-element">
                                    K/D: <%= UserInfo['stats']['past5']['KD'] %>
                                </p>
                                <p class="statgrid-element">
                                    Win: <%= UserInfo['stats']['past5']['wp'] %>%
                                </p>
                            </div>
                        </div>

                    </div>
                    <div class="matches">
                        <h3>Matches (<%= UserInfo['matches'].length %>)</h3>
                        <div class="matchgrid">
                            <div class="matchgrid-item">
                                <p class="matchgrid-element matchgrid-title">
                                    Date
                                </p>
                                <p class="matchgrid-element matchgrid-title">
                                    Map
                                </p>
                                <p class="matchgrid-element matchgrid-title">
                                    Gamemode
                                </p>
                                <p class="matchgrid-element matchgrid-title">
                                    Agent
                                </p>
                                <p class="matchgrid-element matchgrid-title">
                                    K/D
                                </p>
                                <p class="matchgrid-element matchgrid-title">
                                    HS%
                                </p>
                                <p class="matchgrid-element matchgrid-title">
                                    Match Score
                                </p>
                                <p class="matchgrid-element matchgrid-title">

                                </p>
                            </div>
                            <% for (match in UserInfo['matches']) { %>
                                <div class="matchgrid-item">
                                    <p class="matchgrid-element matchgrid-date">
                                        <%= UserInfo['matches'][match]['data']['metadata']['game_start'] %>
                                    </p>
                                    <p class="matchgrid-element">
                                        <%= UserInfo['matches'][match]['data']['metadata']['map'] %>
                                    </p>
                                    <p class="matchgrid-element">
                                        <%= UserInfo['matches'][match]['data']['metadata']['mode'] %>
                                    </p>
                                    <p class="matchgrid-element">
                                        <%= UserInfo['matches'][match]['data']['metadata']['agent'] %>
                                    </p>
                                    <p class="matchgrid-element">
                                        <%= UserInfo['matches'][match]['data']['metadata']['kd'] %>
                                    </p>
                                    <p class="matchgrid-element">
                                        <%= UserInfo['matches'][match]['data']['metadata']['HSP'] %>
                                    </p>
                                    <p class="matchgrid-element">
                                        <%= UserInfo['matches'][match]['data']['metadata']['result'] %>
                                            <%= UserInfo['matches'][match]['data']['metadata']['score'] %>
                                    </p>
                                    <form class="matchgrid-element"
                                        action="/user/<%= UserInfo['username'] %>/<%= UserInfo['tag'] %>/<%= UserInfo['matches'][match]['data']['metadata']['matchid'] %>"
                                        method="get">
                                        <button type="submit" class="view-button">view</button>
                                    </form>
                                </div>
                                <% } %>
                        </div>
                    </div>
    </div>
    <script>
        function getTime(rawTime) {
            // Given epoch time in GMT (milliseconds since January 1, 1970)
            const epochTime = parseInt(rawTime) * 1000; // Example epoch time in milliseconds

            // Convert the epoch time to a Date object
            const date = new Date(epochTime);

            // Specify the time zone you want to convert to (e.g., America/Vancouver)
            const timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;

            // Use Intl.DateTimeFormat to format the date in the specified time zone
            const options = {
                timeZone,
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                // second: '2-digit'
                hour12: false
            };

            const formatter = new Intl.DateTimeFormat('en-US', options);
            const formattedDate = formatter.format(date);
            console.log(rawTime, formattedDate)

            return formattedDate // Output: formatted date and time in the specified time zone

        }

        function updateTimeElements() {
            const timeElements = document.querySelectorAll('.matchgrid-date');
            timeElements.forEach((element) => {
                element.innerHTML = getTime(element.innerHTML);
            });
        }
        window.onload = updateTimeElements;
    </script>
</body>